<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#0050D0">

<meta name="author" content="David Sun">
<link rel="stylesheet" type="text/css" href="azure.css">
<link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16">
<title>
ReBasic: A TI Basic IDE</title>
</head>

<body>
<div id="title">
<svg width="3em" height="3em">
    <a href="index.html">
        <rect class="signum" x="0" y="0" width="3em" height="3em" rx="0.5em" ry="0.5em">
    </a>
</svg>
<h1>
ReBasic: A TI Basic IDE</h1>
</div>
<div id="content">
<p>
I was just looking through my old code and found <a href="https://github.com/davidsun0/ReBasic">ReBasic</a>. It's an IDE + Assembler for the TI-83 and 84 series graphing calculators. On the graphing calculators, you can write your own programs in a language unofficially called TI Basic. Since the calculators come with cables to upload and download files to and from a computer, I thought that I would make a program to help me write TI Basic on my laptop. </p>
<img src="img/rebasic_dark.png"/>
<p>
The IDE itself is written with Processing. The language is ultimately Java, but Processing provides libraries and performs preprocessing to make it beginner-friendly. </p>
<h1 id="Background">Background</h1>
<p>
Back in high school when I wrote this, I spent absurd amounts of time making little games and other cool toys on my TI-83. My fondest memory is of using what I learned in calculus to write a  <a href="https://en.wikipedia.org/wiki/Normal_distribution#Cumulative_distribution_function">normal CDF function</a> more accurate than the built in program on the calculator. </p>
<p>
I was taking AP Statistics, where we regularly used the normal CDF function. While its derivative is easy to work with, we learned that the normal CDF has no closed form. Luckily I was learning about Taylor Series in Calculus at the same time, where we were approximating functions by summing their derivatives. Naturally, I decided to put the two together and see what would happen. </p>
<p>
Taylor Series are actually a great way to approximate the area under the standard normal curve. The function for the normal distribution boils down to e^(x^2), which is easy to infinitely derive. Furthermore, all the points of interest are very close to x=0 since the curve tapers off exponentially. Virtually all interesting values of the standard normal CDF lie between -2 and 2. This means that summing Taylor Series will introduce little numerical errors around the point of derivation (x=0). </p>
<p>
I thought I had all of my math right, but when I compared my program's output to the built in function, the last two digits were always different. Well, it turns out that my program was correct, and the calculator was wrong! Detailed tables online agreed with my program and not the calculator's built-in command. The only problem is that the built in function was instantaneous while my program took a few seconds to run... </p>
<p>
Anyways, ReBasic was a way for me to write programs on my computer and then transfer them over the USB connector.  The calculator didn't have a proper keyboard, commands were hidden behind menu systems, and worst of all, teachers made us delete our programs before a test. It wasn't convenient at all. </p>
<h1 id="A-mathematical-IME">A mathematical IME</h1>
<p>
They way that TI Basic commands work makes writing an editor a non-trivial problem. On the calculator, typing out the letters 's', 'i', and 'n' doesn't give you the sine function. The actual sine function is encoded completely differently and can exist along with the letters 's', 'i', and 'n' in a program. Every command has its own special encoding which has nothing to do with the name or letters in the command. The solution I came up with was inspired by <a href="https://en.wikipedia.org/wiki/Chinese_input_methods_for_computers">Chinese IMEs</a>: you type a series of letters and then press space. If the sequence of letters is a command, ReBasic will automatically convert them into a single token. Press enter and the text you're typing will be entered as literal characters. The working group of characters is underlined for your convinence. Furthermore, keywords are colored so you can be sure what your program represents. </p>
<p>
One other benefit of the IME system is that with it, you can type all of the symbols using only a QWERTY keyboard. For example, typing <code class="inline">arctan(</code> and pressing space converts it to 'tan<sup>-1</sup>('. Every single token in TI Basic has corresponding alpha-numeric sequence(s). <a href="https://github.com/davidsun0/ReBasic/blob/master/data/tokens3.txt">There's a table.</a> Some were user added, like <code class="inline">sqrt</code> which the calculator uses the square root symbol, and the assignment operator, which is a right arrow and is inputted as <code class="inline">-&gt;</code>. This turned out to be very convenient since these are very common symbols. </p>
<h1 id="Writing-a-GUI-system-from-scratch">Writing a GUI system from scratch</h1>
<p>
There's a lot of detail in the program. Processing only provides a 2D canvas, but there's code to render all of the tokens onto the screen. Processing doesn't have any GUI elements, so everything on the screen is made from graphical primitives and my very own event handling system. Special care is taken to render mathematical symbols with Unicode, or custom bitmaps for special characters unique to the TI calculator. </p>
<p>
I'm surprised that I even took the time to draw images for glyphs that aren't in Unicode. In <code class="inline">data/glyphs/</code>, there are a few interesting symbols that are unique to the TI-83. You can type these glyphs with 'invertedequal', 'biguparrow', 'bigdownarrow', 'squaremark', '+mark', '.mark', and 'angle'. </p>
<p>
There's even a dark theme! There isn't a way to change it with the GUI, but changing <a href="https://github.com/davidsun0/ReBasic/blob/master/rebasic.pde#L11">line 11 of rebasic.pde</a> to <code class="inline">colorscheme = night</code> turns the program from light to dark! All of the keystrokes are captured and there's logic for moving the cursor around the screen. The text area even lets you scroll (manually with the arrow keys) beyond the edge of the screen if your program becomes long! </p>
<p>
I like how I had the willingness to write a text editor from scratch back in high school. There were certainly much better ways to do this, but it must have been an interesting challenge to get everything working. </p>
<h1 id="Code-quality">Code quality</h1>
<p>
In total, there are about 2000 lines of code, including whitespace and comments. The code quality is actually higher than I expected. Nothing is awful in the moment to moment code, but the overall architecture is... interesting. Still, 2000 lines is pretty ambitious for a self taught high school student and it's impressive that it more or less works. Some critical features like saving aren't working, but most of the code to make it work is commented out and only needs some editing. </p>
<p>
Unfortunately it doesn't run right out of the box. First of all, Processing expects the folder to match the name of the main file. Since the entry point of the program is in rebasic.pde, the project file needs to be renamed to rebasic. I'm currently using 3.3.5 on Linux, and I'm finding other issues. I had to tweak file loading to use Linux's forward slash instead of Windows backslash to save files. (To be fair, the README does say that it's only been tested on Windows...) Additionally, assembling the output is completely broken. All of the coding logic is there, but it isn't wired up correctly. This is a common theme - what doesn't work is pretty close to working. Most likely I got busy during a refactoring and never picked it up again. I'm sure that it did work at one point in time though. I just don't see myself adding all of the other bells and whistles if the core feature of ReBasic didn't work. The reason I've never gone back and fixed everything is simply because I haven't touched my graphing calculator in years. I just don't have the need for it anymore. </p>
<p>
I wonder if I gave up because it simply became too hard to add new features and make changes. </p>
<h1 id="What-can-be-salvaged">What can be salvaged</h1>
<p>
Anyone willing is more than welcome to pick up where I left off, although I would personally recommend starting from scratch. There are useful resources in the repository which can be reused. </p>
<p>
The repository contains code for encoding and decoding programs for use on a calculator. Looking through the code, it seems like the TI Basic programs all had a very simple format. There is a header that's about 10 bytes long, and every token (command, variable, symbol, etc) maps to one or two bytes in the program file. </p>
<p>
To go along with it, there are tables in the data folder which list every command on the TI-83 along with their textual representation and byte encoding. There is also a list of every symbol which can be used, including duplicates which have no apparent function. </p>
<h1 id="Closing-Thoughts">Closing Thoughts</h1>
<p>
As I write this, I've been working on my own programming language. I've been building and experimenting with intepreters and compilers - it looks like I've been interested in programs that work with programs for quite some time now. I don't mind that ReBasic barely works. It's great that I made what I wanted to make without any worry of what was possible or feasable. </p>
<p>
The project is ambitious, but probably a little overwhelming for a high school student with next to no programming experience. Much of the code could be seriously improved with better algorithms, data structures, and simply not reimplementing parts of the Java standard libraries (I just saw code recreating String.replace). </p>
<p>
Of course, if I had to make the same project today, I would heavily rely on existing code. Using a GUI library would save the work of implementing buttons from scratch, although getting a text box to use custom symbols would still be an interesting challenge. </p>
<p>
Being able to judge my past work so harshly is a great thing. It just shows how much I've improved. Even better, I'm able to pick out design decisions that I do like, which is a sign of how capable I was even in high school. Hopefully the stuff that I'm making today will impress myself years down the road. <br><hr>
<p><a href="index.html">Home</a></p>
<p class="note">Created on 2020-03-30 - Last updated on 2021-02-03</p></div>
</body>
</html>
