<!DOCTYPE html>
<head>
<meta charset="utf-8">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#0050D0">

<meta name="author" content="David Sun">
<link rel="stylesheet" type="text/css" href="azure.css">
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16">
<title>Creating JVM Classes at Runtime</title>
</head>

<body>
<div id="container">
<section id="body">
<!-- body -->
<div><svg width="3em" height="3em" style="float:left; vertical-align:middle;            padding-right: 1em">            <a href="index.html">            <rect x="0" y="0" width="3em" height="3em" rx="0.5em" ry="0.5em"/>            </a>            </svg><h1>Creating JVM Classes at Runtime</h1></div>
<p>
This is how Lateral Lisp compiles at runtime.
</p>
<h2>Java Class Loaders</h2>
<p>
The java.lang.ClassLoader class can allow new classes to be loaded at runtime.
This can be used to load code from a network, or in Lateral's case, to compile
new user defined functions.
</p>
<p>
A relative to self-modifying code, this allows the JVM program to extend its
functionality while running.
</p>
<h2>Class Generation</h2>
<p>
The bytes of a valid JVM class must be loaded into a byte array.
</p>
<h2>Code</h2>
<div class="codeBlock"><code>class MyClassLoader extends ClassLoader {
    public Class&lt;?&gt; defineClass(byte[] bytes) {
         return defineClass(null, bytes, 0, bytes.length);
    }
}
</code></div>
<p>
Reflection must be used to extract and call the methods of the generated class.
</p>
<h2>Notes</h2>
<p>
A loaded class cannot call protected or private methods of a class in the same
package but loaded by another ClassLoader.
</p>
<p>
Classes keep a reference to their ClassLoader. When there are no more references
to the classes or the ClassLoader, they will be discarded by the garbage
collector.
</p>
<h2>Sources</h2>
<p>
<a href="https://www.baeldung.com/java-classloaders">https://www.baeldung.com/java-classloaders</a>
</section>
<br>
<hr>
<p><a href="index.html">Home</a></p>
<p>Last updated on 2020-01-18</p></div>
</body>
</html>
